# cve-details-page Specification

## Purpose

The CVE Details page displays comprehensive information about a specific CVE (Common Vulnerabilities and Exposures) identifier, including description, metadata, vulnerable packages, and references. Users can access this page by clicking on a CVE link from the repository report page.

## Requirements

### Requirement: CVE Details Page Route

The application SHALL provide routes to display CVE details for a specific CVE ID with support for proper breadcrumb navigation and efficient data fetching.

#### Scenario: Navigate to CVE Details page with product and report

- **WHEN** a user navigates to `/reports/product/cve/:productId/:cveId/:reportId` where:
  - `:productId` is a product identifier
  - `:cveId` is a CVE identifier (e.g., "cve-2024-0987")
  - `:reportId` is a report identifier
- **THEN** the CVE Details page displays with the CVE ID from the route parameter
- **AND** the page fetches data directly from the specified report (more efficient than filtering)

#### Scenario: Navigate to CVE Details page with product only

- **WHEN** a user navigates to `/reports/product/cve/:productId/:cveId` where:
  - `:productId` is a product identifier
  - `:cveId` is a CVE identifier (e.g., "cve-2024-0987")
- **THEN** the CVE Details page displays with the CVE ID from the route parameter
- **AND** the page fetches data by filtering reports by CVE ID

#### Scenario: Navigate to CVE Details page for component route

- **WHEN** a user navigates to `/reports/component/cve/:productId/:cveId/:reportId` where:
  - `:productId` is a product identifier (for component routes)
  - `:cveId` is a CVE identifier (e.g., "cve-2024-0987")
  - `:reportId` is a report identifier
- **THEN** the CVE Details page displays with the CVE ID from the route parameter
- **AND** the page fetches data directly from the specified report

#### Scenario: Breadcrumb navigation displays full path

- **WHEN** a user navigates to the CVE Details page with route parameters
- **THEN** a breadcrumb navigation is displayed showing: Reports > ProductId/CVE > Report > CVE Details
- **AND** breadcrumb items are clickable links that navigate to their respective pages, except the last "CVE Details" item which is non-clickable
- **AND** the breadcrumb path is preserved even after page refresh (no dependency on location state)

### Requirement: CVE Details Page Content Structure

The CVE Details page SHALL display content in a structured layout with four cards arranged in a 2x2 grid layout.

#### Scenario: Page displays four cards in grid layout

- **WHEN** a user views the CVE Details page
- **THEN** the page displays four cards organized in a 2x2 grid layout using PatternFly `Grid` and `GridItem` components:
  - Top left: "Description" card
  - Top right: "Metadata" card
  - Bottom left: "Vulnerable Packages" card
  - Bottom right: "References" card
- **AND** the Description and Metadata cards have matching heights using flexbox layout (`height: 100%` and `flex: 1` on CardBody)

#### Scenario: Description card

- **WHEN** a user views the CVE Details page with CVE data loaded
- **THEN** the Description card displays description field
- **AND** the description text is extracted from `info.intel[0].nvd.cve_description` if available and not empty
- **AND** if `nvd.cve_description` is empty or missing, the description is extracted from `info.intel[0].ghsa.description` as a fallback
- **AND** if the description source is `ghsa.description`, the markdown text is rendered as formatted HTML using a markdown rendering library (e.g., `react-markdown`)
- **AND** if the description source is `nvd.cve_description`, the plain text is displayed as-is
- **AND** if no description is available from either source, the card displays "Not Available" using the `NotAvailable` component

#### Scenario: Metadata card

- **WHEN** a user views the CVE Details page with CVE data loaded
- **THEN** the Metadata card displays CVE metadata using PatternFly `DescriptionList` component with the following fields:
  - **CVSS Score**: Displays CVSS severity and score with priority icon using the `CvssBanner` component, which shows severity, icon, and score in the format "Severity Score" (e.g., "High 8.2") where severity is determined from the CVSS score (None, Low, Medium, High, Critical), and the appropriate severity icon is displayed next to the text
  - **EPSS Score**: Displays EPSS percentage in the format "X.XXX%" (e.g., "0.025%") calculated by multiplying `epss.percentage` by 100
  - **CWE**: Displays CWE identifier as a string in the format "CWE-XXX" (e.g., "CWE-22") from `ghsa.cwes[0].cwe_id`
  - **Published**: Displays published date using `FormattedTimestamp` component from `ghsa.published_at` field
  - **Updated**: Displays updated date using `FormattedTimestamp` component from `ghsa.updated_at` field
  - **Credits**: Displays credits as a clickable link where the link text is `credits[0].user.login` and the link URL is `credits[0].user.html_url`, opening in a new tab
- **AND** missing or null data fields display "Not Available" using the `NotAvailable` component

#### Scenario: Vulnerable Packages card

- **WHEN** a user views the CVE Details page with CVE data loaded
- **THEN** the Vulnerable Packages card displays a list of vulnerable packages from `info.intel[0].ghsa.vulnerabilities` array
- **AND** each vulnerable package displays the following information using PatternFly `DescriptionList` component:
  - **Package Name**: Displays `package.name` in bold font (using PatternFly `Title` component with `strong` tag)
  - **Ecosystem**: Displays `package.ecosystem` (e.g., "npm", "pypi", "maven") as a field label and value pair
  - **Vulnerable Version**: Displays `vulnerable_version_range` (e.g., "< 7.5.7") as a field label and value pair
  - **First patched Version**: Displays `first_patched_version` (e.g., "7.5.7") as a field label and value pair
- **AND** if no vulnerable packages are available or the vulnerabilities array is empty, the card displays "Not Available" using the `NotAvailable` component
- **AND** the card supports displaying 0, 1, or more vulnerable packages

#### Scenario: References card

- **WHEN** a user views the CVE Details page with CVE data loaded
- **THEN** the References card displays a list of reference URLs from `info.intel[0].ghsa.references` array
- **AND** each reference URL is displayed as a clickable link using PatternFly `List` and `ListItem` components
- **AND** each reference link opens in a new tab when clicked (using `target="_blank"` and `rel="noreferrer"`)
- **AND** if no references are available or the references array is empty, the card displays "Not Available" using the `NotAvailable` component
